<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>周边搜索（自定义圆）</title>
  <meta name="renderer" content="webkit">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../node_modules/openlayers/dist/ol-debug.css" type="text/css">
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      padding: 0;
      margin: 0;
    }
    .tool {
      position: absolute;
      top: 10px;
      left: calc(50% - 10px);
    }
    .ol-viewport {
      position: inherit!important;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script src="../node_modules/openlayers/dist/ol-debug.js"></script>
<script type="text/javascript">
//  var projection = ol.proj.get('EPSG:3857')
  var projection = ol.proj.get('EPSG:4326')
  var raster = new ol.layer.Tile({
    source: new ol.source.OSM()
  });

  var feat = new ol.Feature({
//    geometry: new ol.geom.Circle([12663576.48345528, 4122525.9344067406], 5000)
    geometry: new ol.geom.Circle([112, 23], transformRadius([112, 23], 5000))
  })

  function transformRadius (center, meterRadius) {
    let lastcoord = new ol.Sphere(6378137).offset(center, meterRadius, (270 / 360) * 2 * Math.PI); //计算偏移量
    let dx = center[0] - lastcoord[0];
    let dy = center[1] - lastcoord[1];
    debugger
    return (Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2)));
  }
  var style = new ol.style.Style({
    fill: new ol.style.Fill({
      color: 'rgba(71, 129, 217, 0.2)'
    }),
    stroke: new ol.style.Stroke({
      color: 'rgba(71, 129, 217, 1)',
      width: 1
    }),
    image: new ol.style.Circle({
      radius: 5,
      fill: new ol.style.Fill({
        color: 'rgba(71, 129, 217, 0.2)'
      })
    })
  })

  feat.setStyle(style)

  var source = new ol.source.Vector();
  source.addFeature(feat);
  var vector = new ol.layer.Vector({
    source: source,
    style: style
  });
  var map = new ol.Map({
    layers: [raster, vector],
    target: 'map',
    view: new ol.View({
//      center: [12663576.48345528, 4122525.9344067406],
      center: [112, 23],
      zoom: 5,
      projection: projection
    })
  })

  map.on('click', function (event) {
    console.log(event.coordinate)
  })
</script>
</body>
</html>