<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HMap | 示例</title>
  <link rel="shortcut icon" href="./images/logo.png" type="image/png">
  <link rel="stylesheet" href="./css/main.css">
  <link rel="stylesheet" href="https://unpkg.com/perfect-scrollbar@0.8.1/dist/css/perfect-scrollbar.min.css">
  <link rel="stylesheet" href="https://unpkg.com/bootstrap@3.3.7/dist/css/bootstrap.min.css">
</head>
<body>
<div id="main">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <a href="" class="navbar-brand">
          <img src="./images/logo.png" alt="hmap logo" class="navbar-logo">
        </a>
      </div>
      <div id="navbar-collapse" class="collapse navbar-collapse clearfix">
        <ul class="nav navbar-nav navbar-left clearfix">
          <li id="nav-index">
            <a href="https://sakitam-fdd.github.io/HMap">首页</a>
          </li>
          <li id="nav-doc" class="dropdown">
            <a href="https://sakitam-fdd.github.io/HMap/documents/" target="_blank">文档</a>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li id="nav-github">
            <a href="https://github.com/sakitam-fdd/HMap" target="_blank">
              <img src="./images/github.png" width="18"></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div id="left-item-nav">
    <ul></ul>
  </div>
  <div id="explore-container">
    <div class="item-list-panel"></div>
  </div>
</div>
<script src="https://unpkg.com/jquery@3.2.1/dist/jquery.js"></script>
<script src="./scripts/jquery.lazyload.min.js"></script>
<script src="https://unpkg.com/perfect-scrollbar@0.8.1/dist/js/perfect-scrollbar.min.js"></script>
<script src="https://unpkg.com/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<script src="./scripts/waypoint.js"></script>
<script src="data.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    $('#navbar-collapse .navbar-left').on('click', function (event) {
      var ev = event || window.event;
      var target = ev.target || ev.srcElement;
      $(this).find('.active').removeClass('active');
      if (target.nodeName.toLowerCase() === 'li') {
        $(target).addClass('active');
      } else if (target.nodeName.toLowerCase() === 'a') {
        $(target).parent('li').addClass('active');
      }
    })
    var $container = $('#explore-container .item-list-panel');
    var nav = $('#left-item-nav ul')
    navList.forEach(function (item) {
      nav.append($("<li>").append(
        '<a class="left-list-nav-link" id="left-item-nav-' + item['href'] + '" ' +
        'href="#item-type-' + item['href'] + '">' +
        '<div class="item-icon" style="background-image: url(' + item['icon'] + ');"></div>' +
        '<div class="item-name">' + item['name'] + "</div>" +
        "</a>"));

      $container.append('<h3 class="item-type-head" id="item-type-'
        + item['href'] + '">' + item['name'] + '</h3>')
        .append('<div class="row" id="item-row-' + item['href'] + '"></div>');
    })
    var listTarget = $("#left-item-nav");
    var layer = $('#nav-layer');
    var mask = $('#nav-mask');

    /**
     * 鼠标移入列表事件
     * @param type
     */
    function hoverNav(type) {
      var liString = '';
      for (var eid = 0, elen = EXAMPLES.length; eid < elen; ++eid) {
        if (EXAMPLES[eid].type === type) {
          liString += '<li>'
            +   '<a href="demo.html#' + EXAMPLES[eid].id + '">'
            +       '<img src="' + GALLERY_THUMB_PATH + EXAMPLES[eid].id + '.png">'
            +   '</a>'
            +'</li>';
        }
      }
      $('#nav-layer .chart-list').html(liString);
    }

    /**
     * 获取列表距头部高度
     * @param top
     * @param height
     * @returns {*}
     */
    function getLayerTop(top, height) {
      var windowHeight = $(window).height();
      var maxTop = windowHeight - height;
      if (top >= maxTop) {
        top = maxTop;
      }
      return top;
    }

    /**
     * 切换
     * @param isshow
     */
    function toggle(isshow) {
    }

    listTarget.on('mouseover', function () {
      toggle(true);
    });

    $(listTarget).find('ul').on('click', function (event) {
      var ev = event || window.event;
      var target = ev.target || ev.srcElement;
      $(this).find('.active').removeClass('active');
      if (target.nodeName.toLowerCase() === 'a') {
        $(target).parent('li').addClass('active');
      } else if (target.nodeName.toLowerCase() === 'div') {
        $(target).parent().parent('li').addClass('active');
      }
    });

    layer.on('click', '.iconfont', function () {
      toggle(false);
    }).on('mouseover', function () {
      toggle(true);
      Ps.update(layer[0]);
    });
    mask.on('mouseover', function () {
      setTimeout(function () {
        toggle(false);
      }, 200);
    });
    Ps.initialize(listTarget[0]);

    // 示例容器
    examplesList.forEach(function (item) {
      if (item['childrens'].length > 0) {
        item['childrens'].forEach(function (cls) {
          // show title if exists
          var title = cls.title || '未命名图表';
          var subtitle = cls.subtitle || '点击查看详情';
          // append dom element
          var $row = $('<div class="col-lg-3 col-md-4 col-sm-6"></div>');
          var $chart = $('<div class="item-ls"></div>');
          $('#item-row-' + item['alias']).append($row.append($chart));

          var $link = $('<a target="_blank" class="item-link" href="' + cls['url'] + '"></a>');
          $chart.append($link);
          $link.append('<h4 class="item-title">' + title + '</h4>')
          var $chartArea = $('<img class="item-area" data-original="' + cls['icon'] +'" />');
          $link.append($chartArea);
        })
      }
    })

    var waypoints = $('.item-type-head').waypoint(function (direction) {
      var names = this.element.id.split('-');
      if (names.length === 3) {
        $('#left-item-nav li').removeClass('active');
        $('#left-item-nav-' + names[2]).parent('li').addClass('active');
      }
    }, {
      offset: 70
    });

    window.addEventListener('hashchange', function () {
      scrollBy(0, -80);
      var names = location.hash.split('-');
      if (names.length === 3) {
        $('#left-item-nav li').removeClass('active');
        $('#left-item-nav-' + names[2]).parent('li').addClass('active');
      }
    });

    // highlight the first chart in chart navbar
    $('#left-item-nav li').first().addClass('active');

    // Lazy load
    $('.item-area').lazyload();
  });
</script>
</body>
</html>
